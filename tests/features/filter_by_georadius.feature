Feature: Фильтрация по центру и радиусу (георадиус)
  Как пользователь, я хочу фильтровать точки по расстоянию от заданного центра,
  чтобы анализировать данные в определённой географической области.

  Scenario: Happy path — фильтрация по центру и радиусу
    Given я загрузил CSV с точками в разных городах:
      """
      lat,lon,name
      55.75,37.62,Москва
      59.9343,30.3351,Санкт-Петербург
      56.8389,60.6057,Екатеринбург
      55.7558,37.6173,Москва-центр
      """
    When я выбираю фильтр "По георадиусу"
    And указываю центр: "55.75,37.62"
    And указываю радиус: "50" км
    And нажимаю "Применить фильтр"
    Then на карте отображаются 2 маркера
    And маркеры находятся в пределах 50 км от центра
    And на карте отображается круг радиусом 50 км от центра
    And в легенде показано "Отфильтровано: 2 из 4 точек"

  Scenario: Интерактивный выбор центра на карте
    Given я загрузил данные с координатами
    When я выбираю фильтр "По георадиусу"
    And нажимаю "Выбрать центр на карте"
    And кликаю на карте по точке 55.75,37.62
    And указываю радиус: "100" км
    And нажимаю "Применить фильтр"
    Then центр автоматически заполняется координатами 55.75,37.62
    And фильтр применяется с выбранным центром

  Scenario: Edge case — все точки вне радиуса
    Given я загрузил CSV с точками в России
    When я указываю центр в Японии: "35.6762,139.6503"
    And указываю радиус: "100" км
    And нажимаю "Применить фильтр"
    Then на карте не отображаются маркеры
    And я вижу сообщение "Нет точек в указанном радиусе"
    And круг георадиуса всё равно отображается на карте

  Scenario: Edge case — некорректный центр
    Given я загрузил данные
    When я указываю центр: "190,200"
    And указываю радиус: "50" км
    Then я вижу сообщение об ошибке "Некорректные координаты центра"
    And фильтр не применяется

  Scenario: Edge case — отрицательный или нулевой радиус
    Given я загрузил данные
    When я указываю центр: "55.75,37.62"
    And указываю радиус: "-10" км
    Then я вижу сообщение об ошибке "Радиус должен быть положительным числом"
    And фильтр не применяется

  Scenario: Изменение радиуса с сохранением центра
    Given я применил фильтр с центром "55.75,37.62" и радиусом "50" км
    When я меняю радиус на "100" км
    And нажимаю "Применить фильтр"
    Then центр остаётся прежним
    And круг на карте увеличивается до 100 км
    And количество отфильтрованных точек пересчитывается

  Scenario: Комбинация фильтров — дата + георадиус
    Given я загрузил CSV с координатами и timestamp
    When я применяю фильтр "По месяцу" = "2024-02"
    And применяю фильтр "По георадиусу" с центром "55.75,37.62" и радиусом "50" км
    Then на карте отображаются точки, удовлетворяющие ОБОИМ фильтрам
    And в легенде показано количество точек после применения всех фильтров

