Feature: Предпросмотр и подсчёт отфильтрованных данных
  Как пользователь, я хочу видеть предпросмотр и количество отфильтрованных строк,
  чтобы понимать результат фильтрации до отображения на карте.

  Scenario: Happy path — предпросмотр при фильтрации по дате
    Given я загрузил CSV с 10 точками за разные месяцы
    When я выбираю фильтр "По месяцу" = "2024-02"
    Then я вижу предпросмотр с информацией "Будет показано: 3 из 10 точек"
    And отображается таблица с первыми 5 строками отфильтрованных данных
    And в таблице показаны колонки: lat, lon, timestamp

  Scenario: Happy path — предпросмотр при фильтрации по георадиусу
    Given я загрузил CSV с точками в разных городах
    When я применяю фильтр по георадиусу с центром "55.75,37.62" и радиусом "50" км
    Then я вижу предпросмотр "Будет показано: 5 из 20 точек"
    And отображается таблица с отфильтрованными точками
    And для каждой точки показано расстояние до центра

  Scenario: Предпросмотр при комбинации фильтров
    Given я загрузил CSV с координатами и timestamp
    When я применяю фильтр по месяцу "2024-02"
    And применяю фильтр по георадиусу с радиусом "100" км
    Then я вижу предпросмотр "Будет показано: 2 из 50 точек"
    And в таблице отображаются только точки, прошедшие оба фильтра

  Scenario: Подсчёт в реальном времени при изменении фильтра
    Given я применил фильтр по месяцу "2024-01"
    And вижу "Будет показано: 10 из 50 точек"
    When я меняю месяц на "2024-03"
    Then счётчик автоматически обновляется на "Будет показано: 8 из 50 точек"
    And предпросмотр таблицы обновляется соответствующими данными

  Scenario: Edge case — нет данных после фильтрации
    Given я загрузил CSV с данными
    When я применяю фильтр, который не соответствует ни одной точке
    Then я вижу "Будет показано: 0 из N точек"
    And отображается сообщение "Нет точек, соответствующих фильтру"
    And таблица предпросмотра пустая

  Scenario: Экспорт отфильтрованных данных
    Given я применил фильтры и вижу "Будет показано: 15 из 100 точек"
    When я нажимаю кнопку "Экспортировать отфильтрованные данные"
    Then скачивается CSV файл с 15 отфильтрованными строками
    And файл содержит все исходные колонки

  Scenario: Переключение между предпросмотром и картой
    Given я применил фильтр и вижу предпросмотр
    When я нажимаю "Показать на карте"
    Then открывается карта с отфильтрованными точками
    And кнопка меняется на "Показать предпросмотр"
    When я нажимаю "Показать предпросмотр"
    Then возвращаюсь к табличному виду

  Scenario: Постраничный просмотр отфильтрованных данных
    Given я отфильтровал 50 точек из 200
    And вижу предпросмотр с пагинацией
    When я нахожусь на странице 1 (показаны строки 1-10)
    And нажимаю "Следующая страница"
    Then отображаются строки 11-20
    And счётчик показывает "Страница 2 из 5"

